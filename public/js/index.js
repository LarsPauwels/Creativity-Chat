"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var toggle=document.querySelector(".card__toggle"),container=document.querySelector(".container"),close=document.querySelector(".card__close"),register=document.getElementById("register"),username=document.getElementById("usernameRegister"),login=document.getElementById("login");toggle.addEventListener("click",function(){container.id="active"}),close.addEventListener("click",function(){container.id=""});var Cookie=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"setCookie",value:function(e,t,n){var o="";if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),o="; expires="+r.toUTCString()}document.cookie=e+"="+(t||"")+o+"; path=/"}},{key:"getCookie",value:function(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var r=n[o];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null}}]),e}();null!=Cookie.getCookie("username")&&(location.href="chat.html"),register.addEventListener("click",function(e){(new User).usernameExists(username.value),e.preventDefault()}),login.addEventListener("click",function(e){(new User).login(),e.preventDefault()});var User=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"createUser",value:function(){var t=username.value,e=document.getElementById("passwordRegister").value,n=document.getElementById("passwordConfirm").value;if(this.setPrimus(t),this.emptyFields(t,e,n))if(this.passwordEqual(e,n)){e=sha1(e);var o={username:t,password:e,timestamp:getTimestamp()};fetch("./api/v1/user",{method:"post",headers:{"Content-type":"application/json"},body:JSON.stringify(o)}).then(function(e){return e.json()}).then(function(e){Cookie.setCookie("username",t,10),location.href="chat.html"}).catch(function(e){console.log(e)})}else console.log("Your password and cofirm password are not the same.");else console.log("You need to fill in all required fields.")}},{key:"emptyFields",value:function(e,t,n){return""!=e&&""!=t&&""!=n}},{key:"passwordEqual",value:function(e,t){return e===t}},{key:"usernameExists",value:function(e){var t=this,n="./api/v1/user?user=".concat(e);fetch(n,{method:"get",headers:{"Content-type":"application/json"}}).then(function(e){return e.json()}).then(function(e){"success"==e.status?console.log("This username is already in use."):"error"==e.status&&t.createUser()}).catch(function(e){console.log(e)})}},{key:"setPrimus",value:function(e){this.primus=Primus.connect("/",{reconnect:{max:1/0,min:500,retries:10}}),this.primus.write({username:e})}},{key:"login",value:function(){var t=document.getElementById("usernameLogin").value,n=sha1(document.getElementById("passwordLogin").value);if(this.emptyFields(t,n,"empty")){var e="./api/v1/user?user=".concat(t);fetch(e,{method:"get",headers:{"Content-type":"application/json"}}).then(function(e){return e.json()}).then(function(e){"success"==e.status?e.message.password==n?(Cookie.setCookie("username",t,10),location.href="chat.html"):console.log("Your username or password is incorrect."):"error"==e.status&&console.log("Your username or password is incorrect.")}).catch(function(e){console.log(e)})}}}]),e}();function getTimestamp(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate(),r=e.getHours(),s=e.getMinutes();return r<10&&(r="0"+r),s<10&&(s="0"+s),"".concat(o,"/").concat(n,"/").concat(t," ").concat(r,":").concat(s)}